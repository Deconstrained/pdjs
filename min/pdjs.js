(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};window.PDJSobj=function(){function t(){this.update_things=e(this.update_things,this),this.attach_things=e(this.attach_things,this)}return t.version=.2,t.server="pagerduty.dev",t.protocol="http",t.req_count=1,t.req=function(){return t.req_count++},t.prototype.set_token=function(e){return this.token=e},t.prototype.set_subdomain=function(e){return this.subdomain=e},t.prototype.update_service_incidents=function(e){var t,n,r;return r=new Date,n=new Date(r.getTime()-90*PDJStools.SECONDS_IN_A_DAY),t={url:"https://"+this.subdomain+".pagerduty.com/api/v1/incidents",type:"GET",headers:{Authorization:"Token token="+this.token},data:{status:"resolved",service:e,sort_by:"created_on:desc",since:n.toISOString(),until:r.toISOString()},success:function(t){var n,r,i,s,o,u,a,f,l,c,h,p;PDJStools.logg(t),r={},f=0,l=0,n=PDJStools.SECONDS_IN_A_DAY*365,o=0,s="no-one",p=t.incidents;for(c=0,h=p.length;c<h;c++)i=p[c],a=new Date(i.last_status_change_on)-new Date(i.created_on),l=Math.max(l,a),n=Math.min(n,a),f+=a,r[i.last_status_change_by.name]=(r[i.last_status_change_by.name]||0)+1,r[i.last_status_change_by.name]>o&&(o=r[i.last_status_change_by.name],s=i.last_status_change_by.name);return u={best_time:PDJStools.timeAsWords(n),worst_time:PDJStools.timeAsWords(l),total_time:PDJStools.timeAsWords(f),average_time:PDJStools.timeAsWords(f/t.incidents.length),uptime:(new String((1-f/(PDJStools.SECONDS_IN_A_DAY*90))*100)).substr(0,5),leader:s,leader_resolves:o,heroes:r},$("#"+e+".pdjs_service_incidents").html("The average incident takes "+u.average_time+" ( "+u.best_time+" - "+u.worst_time+" ) "+u.leader+" has resolved "+u.leader_resolves+" incidents"),u}},PDJStools.logg(t),$.ajax(t)},t.prototype.open_service=function(e){return window.open("https://"+this.subdomain+".pagerduty.com/services/"+e.id)},t.prototype.update_service=function(e){var t=this;return PDJStools.logg("update_service: "+e+" at "+this.subdomain),this.api({res:"services/"+e,success:function(n){var r,i;i="resolved",n.service.incident_counts.acknowledged&&(i="acknowledged"),n.service.incident_counts.triggered&&(i="triggered"),n.service.status==="disabled"&&(i="disabled");if(t.services[e]!==i)return r='Service: "'+n.service.name+'" was '+i+" as of "+PDJStools.timeUntil(n.service.last_incident_timestamp),$("#"+e+".pdjs_service").removeClass("pdjs_triggered").removeClass("pdjs_acknowledged").removeClass("pdjs_resolved").removeClass("pdjs_disabled"),$("#"+e+".pdjs_service").attr("title",r).addClass("pdjs_"+i),t.services[e]=i}})},t.prototype.update_schedule=function(e){return PDJStools.logg("update_schedule: "+e),this.api({res:"schedules/"+e+"/entries",data:{overflow:"true",since:(new Date).toISOString(),until:(new Date).toISOString()},success:function(t){var n,r,i;return PDJStools.logg(t),r=t.entries[0],n=new Date(r.end),i='<a href="https://pdt-dave.pagerduty.com/users/'+r.user.id+'" target="_blank">'+r.user.name+"</a> is on call for another "+PDJStools.timeUntil(n),$("#"+e+".pdjs_schedule").html(i)}})},t.prototype.api=function(e){return PDJStools.logg("Call to API: "),PDJStools.logg(this),PDJStools.logg(e),e.url=e.url||t.protocol+"://"+this.subdomain+"."+t.server+"/api/v1/"+e.res,e.headers=e.headers||[],e.contentType="application/json",e.data=e.data||[],e.data.PDJSversion=t.version,e.data.request_count=t.req(),e.headers.Authorization="Token token="+this.token,e.error=function(e){return PDJStools.logg("Error"),PDJStools.logg(e.status),PDJStools.logg(e.responseText)},PDJStools.logg(e),$.ajax(e)},t.prototype.attach_things=function(e,t,n){return n==null&&(n=60),this.subdomain=e,this.token=t,this.refresh=n,this.services={},this.update_things()},t.prototype.update_things=function(){var e,t,n,r,i,s,o,u,a,f,l;u=$(".pdjs_service_incidents");for(t=0,i=u.length;t<i;t++)e=u[t],this.update_service_incidents(e.id);a=$(".pdjs_service");for(n=0,s=a.length;n<s;n++)e=a[n],this.update_service(e.id);f=$(".pdjs_schedule"),l=[];for(r=0,o=f.length;r<o;r++)e=f[r],l.push(this.update_schedule(e.id));return l},t}(),jQuery(function(){return window.PDJS=new window.PDJSobj,PDJS.attach_things(pdjs_settings.subdomain,pdjs_settings.token,pdjs_settings.refresh),window.PDJS.update_schedule("PQBSD51")}),window.PDJStools=function(){function e(){}return e.SECONDS_IN_A_DAY=864e5,e.logging=!0,e.logg=function(e){if(this.logging)return console.log(e)},e.timeUntil=function(e){return this.timeBetween(e,new Date)},e.timeBetween=function(e,t){var n;return typeof e=="string"&&(e=new Date(e)),typeof t=="string"&&(t=new Date(t)),n=Math.abs(t-e),this.timeAsWords(n)},e.timeAsWords=function(e){var t,n,r,i,s,o,u;return e<1e3?"0 seconds":(r=[[1e3,"millisecond"],[60,"second"],[60,"minute"],[24,"hour"],[7,"day"],[52,"week"],[99999,"year"]],i=this.SECONDS_IN_A_DAY*7*52,u="f: "+i,s=r.length-1,o=function(){var o;o=[];while(s-=1)e>i&&(t=Math.floor(e/i),u=t+" "+r[s+1][1],t>1&&(u+="s"),s>0&&(n=Math.floor(e%i/(i/r[s][0])),n>0&&(u=u+" and "+n+" "+r[s][1]),n>1&&(u+="s")),e=0),o.push(i/=r[s][0]);return o}(),u)},e}(),window.PDJSt=PDJStools,PDJStools.logg("test")}).call(this)